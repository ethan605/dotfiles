#!/usr/bin/env bash
set -Eeuo pipefail

function get_performance_mode() {
  declare -A mode_hash=(
    [balanced]="B"
    [low-power]="L"
    [performance]="P"
  )

  local mode=$(cat /sys/firmware/acpi/platform_profile)

  local json=$(cat << EOF
  {
    "text": "${mode_hash[$mode]}",
    "class": "$mode",
    "tooltip": "${mode^} mode\n\nFn+l\t-\tLow-power mode\nFn+m\t-\tBalanced mode\nFn+h\t-\tPerformance mode"
  }
EOF
)

  echo "$json" | jq --compact-output
}

function get_vpn_info() {
  local json=$(cat << EOF
  {
    "tooltip": "ïƒ¨   $(ip route | rg 'tun0 proto kernel' | cut -d'/' -f1)"
  }
EOF
)

  echo "$json" | jq --compact-output
}

function main() {
  local sub_command=${1-}

  case "$sub_command" in
    performance-mode) get_performance_mode ;;
    vpn-info) get_vpn_info ;;
    *) ;;
  esac
}

main "$@"
